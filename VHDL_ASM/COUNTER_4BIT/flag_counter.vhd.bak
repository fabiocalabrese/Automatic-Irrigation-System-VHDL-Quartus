LIBRARY ieee;
USE ieee.std_logic_1164.all;

-- descrizione del counter a 4 t-flipflop che serve a contare il numero di volte consecutive di average sotto soglia

ENTITY flag_counter IS
	GENERIC ( n : 4 IN STD_LOGIC_VECTOR(n-1 DOWNTO 0) 		
	PORT( enable, clock, reset : IN STD_LOGIC;
			count : OUT STD_LOGIC_VECTOR(n-1 DOWNTO 0));
			
END flag_counter;


ARCHITECTURE behavior OF flag_counter IS


	COMPONENT t_flipflop 
 
		PORT ( 
			T : IN STD_LOGIC;
			clk,resetn : IN STD_LOGIC;
			Q : OUT STD_LOGIC
			
			);
			
	END COMPONENT;
 
	SIGNAL qsignal : STD_LOGIC_VECTOR(n-1 DOWNTO 0);  -- sarà il segnale di uscita di ciascun t-flipflop.
	SIGNAL and_link : STD_LOGIC_VECTOR(n-2 DOWNTO 0); -- sarà il segnale di uscita di ciascuna operazione logica svolta (step successivo).
 
	BEGIN
   
	tf1 : t_flipflop PORT MAP ( T => enable, clk => clock, resetn => reset ,Q => qsignal(0)); -- il primo t-flipflop presenta come segnale di T = SW(1),ovvero l'enable.
     
	and_link(0) <= enable AND qsignal(0); -- la prima porta and ha come ingressi l'enable e il segnale di uscita di tf1.
	
	  G : FOR i IN 1 TO n-1 GENERATE 
     
		tf : t_flipflop PORT MAP ( T => and_link(i-1), clk => clock, resetn => reset ,Q => qsignal(i));
		and_link(i) <= and_link(i-1) AND qsignal(i);
	  
	  END GENERATE;
	
	tff : t_flipflop PORT MAP ( T => and_link(n-1), clk => clock, resetn => reset ,Q => qsignal(n));
	
	count <= qsignal;
	
END ARCHITECTURE; 
   
  